{"version":3,"sources":["components/form.js","components/login.js","App.js","index.js"],"names":["Form","props","addBook","setIsLoading","bookToEdit","setBooks","setMessage","fetchWithCsrf","useState","title","setTitle","author","setAuthor","priceInEuro","setPriceInEuro","book","a","fetchOptions","method","body","JSON","stringify","process","response","json","ok","console","log","status","error","message","errorMessage","errors","reduce","accumulator","defaultMessage","id","useEffect","className","onSubmit","e","preventDefault","type","onChange","target","value","pattern","min","max","parseInt","onClick","createBook","editBook","Login","username","setUsername","password","setPassword","authenticate","handleLogin","App","books","isLoading","setBookToEdit","localStorage","getItem","userName","setUserName","csrfToken","setCsrfToken","getBooks","usernameForm","passwordForm","credentials","headers","authorization","window","btoa","fetch","get","setItem","url","options","clear","map","b","style","backgroundColor","deleteBook","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.33654396.chunk.js","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport \"../App.css\";\n\nfunction Form(props) {\n  const {\n    addBook,\n    setIsLoading,\n    bookToEdit,\n    setBooks,\n    setMessage,\n    fetchWithCsrf,\n  } = props;\n  const [title, setTitle] = useState(\"\");\n  const [author, setAuthor] = useState(\"\");\n  const [priceInEuro, setPriceInEuro] = useState(0);\n\n  async function createBook(book) {\n    setIsLoading(true);\n    const fetchOptions = {\n      method: \"POST\",\n      body: JSON.stringify(book),\n    };\n    try {\n      const response = await fetchWithCsrf(\n        `${process.env.REACT_APP_URL_SERVER}/books`,\n        fetchOptions\n      );\n      const body = await response.json();\n      if (response.ok) {\n        console.log(\n          `async createBook: received response ${JSON.stringify(body)}`\n        );\n        addBook(body);\n        setMessage(\"Book added successfully.\");\n        console.log(\"createBook: done\");\n      } else {\n        console.log(\n          `async createBook: ERROR: ${response.status} - ${body.error} - ${body.message}`\n        );\n        const errorMessage =\n          body.errors &&\n          body.errors.reduce(\n            (accumulator, error) =>\n              `${accumulator} ${error.defaultMessage} ---`,\n            \"--- \"\n          );\n        setMessage(errorMessage || body.message);\n      }\n    } catch (e) {\n      console.log(e);\n      setMessage(\"Connection error.\");\n    }\n\n    setIsLoading(false);\n  }\n\n  async function editBook(book) {\n    // book.title = title;\n    // book.author = author;\n    // book.priceInEuro = priceInEuro;\n\n    const fetchOptions = {\n      method: \"PUT\",\n      body: JSON.stringify({\n        id: book.id,\n        title: title,\n        author: author,\n        priceInEuro: priceInEuro,\n      }),\n    };\n\n    try {\n      const response = await fetchWithCsrf(\n        `${process.env.REACT_APP_URL_SERVER}/books/${book.id}`,\n        fetchOptions\n      );\n      const body = await response.json();\n      console.log(body);\n      if (response.ok) {\n        setMessage(\"Book edited successfully.\");\n        console.log(\"createBook: done\");\n        setBooks(body);\n      } else {\n        const errorMessage =\n          body.errors &&\n          body.errors.reduce(\n            (accumulator, error) =>\n              `${accumulator} ${error.defaultMessage} ---`,\n            \"--- \"\n          );\n        setMessage(errorMessage || body.message);\n      }\n    } catch (e) {\n      console.log(e);\n      setMessage(\"Connection error.\");\n    }\n  }\n\n  useEffect(() => {\n    if (bookToEdit) {\n      setTitle(bookToEdit.title);\n      setAuthor(bookToEdit.author);\n      setPriceInEuro(bookToEdit.priceInEuro);\n    }\n  }, [bookToEdit]);\n\n  return (\n    <form\n      className=\"form\"\n      onSubmit={(e) => {\n        e.preventDefault();\n      }}\n    >\n      Title:\n      <input\n        className=\"form__input\"\n        type=\"text\"\n        onChange={(e) => setTitle(e.target.value)}\n        value={title}\n        pattern=\"(.|\\s)*\\S(.|\\s)*\"\n      />\n      Author:\n      <input\n        className=\"form__input\"\n        type=\"text\"\n        onChange={(e) => setAuthor(e.target.value)}\n        value={author}\n        pattern=\"(.|\\s)*\\S(.|\\s)*\"\n      />\n      Price:\n      <input\n        className=\"form__input\"\n        type=\"number\"\n        min={0}\n        max={2000}\n        value={priceInEuro}\n        onChange={(e) => setPriceInEuro(parseInt(e.target.value))}\n      />\n      <button\n        className=\"form__button\"\n        onClick={() =>\n          createBook({\n            title: title,\n            author: author,\n            priceInEuro: priceInEuro,\n          })\n        }\n      >\n        Bevestigen\n      </button>\n      <button\n        className=\"form__button\"\n        onClick={\n          bookToEdit !== null\n            ? () => editBook(bookToEdit)\n            : console.log(\"Deze boek bestaat niet.\")\n        }\n      >\n        Bewerken\n      </button>\n    </form>\n  );\n}\n\nexport default Form;\n","import React, { useState } from \"react\";\nimport \"../App.css\";\n\nfunction Login(props) {\n    const [username, setUsername] = useState(\"\");\n    const [password, setPassword] = useState(\"\");\n    const { authenticate } = props;\n    async function handleLogin() {\n        authenticate(username, password);\n        setUsername(\"\");\n        setPassword(\"\");\n    }\n    return (\n        <form className=\"login__form\" onSubmit={(e) => e.preventDefault()}>\n            Username:\n            <input\n                type=\"text\"\n                className=\"login__input\"\n                onChange={(e) => setUsername(e.target.value)}\n                value={username}\n            />\n            Password:\n            <input\n                type=\"password\"\n                className=\"login__input\"\n                onChange={(e) => setPassword(e.target.value)}\n                value={password}\n            />\n            <button className=\"login__submit\" onClick={() => handleLogin()}>\n                Login\n            </button>\n        </form>\n    );\n}\n\nexport default Login;\n","import { useEffect, useState } from \"react\";\nimport \"./App.css\";\nimport Form from \"./components/form\";\nimport Login from \"./components/login\";\n\nfunction App() {\n    const [books, setBooks] = useState([]);\n    const [isLoading, setIsLoading] = useState(false);\n    const [bookToEdit, setBookToEdit] = useState(null);\n    const [message, setMessage] = useState(\"\");\n    const [userName, setUserName] = useState(() =>\n        localStorage.getItem(\"user\")\n    );\n    const [csrfToken, setCsrfToken] = useState(() =>\n        localStorage.getItem(\"csrfToken\")\n    );\n\n    async function getBooks() {\n        setIsLoading(true);\n        try {\n            const fetchOptions = {\n                method: \"GET\",\n            };\n            const response = await fetchWithCsrf(\n                `${process.env.REACT_APP_URL_SERVER}/books`,\n                fetchOptions\n            );\n            console.log(response);\n            if (response.ok) {\n                const body = await response.json();\n                setBooks(body);\n            }\n        } catch (e) {\n            console.log(e);\n            setMessage(\"Connection error.\");\n        }\n        setIsLoading(false);\n    }\n\n    async function authenticate(usernameForm, passwordForm) {\n        console.log(`username: ${usernameForm}\\npassword: ${passwordForm}`);\n        const fetchOptions = {\n            method: \"GET\",\n            credentials: \"include\",\n            headers: {\n                \"Content-Type\": \"application/json;charset=utf-8\",\n                \"X-Requested-With\": \"XMLHttpRequest\",\n                authorization:\n                    \"Basic \" + window.btoa(`${usernameForm}:${passwordForm}`),\n            },\n        };\n\n        const response = await fetch(\n            `${process.env.REACT_APP_URL_SERVER}/authenticate`,\n            fetchOptions\n        );\n        console.log(response.headers.get(\"X-XSRF-TOKEN\"));\n        localStorage.setItem(\"csrfToken\", response.headers.get(\"X-XSRF-TOKEN\"));\n        setCsrfToken(response.headers.get(\"X-XSRF-TOKEN\") || csrfToken);\n        if (response.ok) {\n            const body = await response.json();\n            console.log(body);\n            localStorage.setItem(\"user\", body.username);\n            setUserName(body.username);\n        } else {\n            setMessage(\"Failed to login\");\n            console.log(response);\n        }\n    }\n\n    useEffect(() => {\n        console.log(csrfToken);\n    }, [csrfToken]);\n\n    function getCookie(cname) {\n        var name = cname + \"=\";\n        var decodedCookie = decodeURIComponent(document.cookie);\n        var ca = decodedCookie.split(\";\");\n        for (var i = 0; i < ca.length; i++) {\n            var c = ca[i];\n            while (c.charAt(0) === \" \") {\n                c = c.substring(1);\n            }\n            if (c.indexOf(name) === 0) {\n                return c.substring(name.length, c.length);\n            }\n        }\n        return \"\";\n    }\n\n    async function fetchWithCsrf(url, options) {\n        const fetchOptions = {\n            method: options.method,\n            credentials: \"include\",\n\n            headers: csrfToken\n                ? {\n                      \"Content-Type\": \"application/json;charset=utf-8\",\n                      \"X-Requested-With\": \"XMLHttpRequest\",\n                      \"X-XSRF-TOKEN\": csrfToken,\n                  }\n                : {\n                      \"Content-Type\": \"application/json;charset=utf-8\",\n                      \"X-Requested-With\": \"XMLHttpRequest\",\n                  },\n            body: options.body,\n        };\n        return await fetch(url, fetchOptions);\n    }\n\n    async function logout() {\n        const fetchOptions = {\n            method: \"POST\",\n        };\n        const response = await fetchWithCsrf(\n            `${process.env.REACT_APP_URL_SERVER}/logout`,\n            fetchOptions\n        );\n        setUserName(null);\n        localStorage.clear();\n        console.log(response);\n    }\n\n    useEffect(() => {\n        if (userName !== null) {\n            getBooks();\n        }\n    }, [userName]);\n\n    async function deleteBook(book) {\n        const fetchOptions = {\n            method: \"DELETE\",\n        };\n\n        try {\n            const response = await fetchWithCsrf(\n                `${process.env.REACT_APP_URL_SERVER}/books/${book.id}`,\n                fetchOptions\n            );\n            const body = await response.json();\n            if (response.ok) {\n                setMessage(\"Book deleted successfully.\");\n                setBooks(body);\n            } else {\n                setMessage(`${body.message}`);\n            }\n        } catch (e) {\n            console.log(e);\n            setMessage(\"Connection error.\");\n        }\n    }\n\n    return (\n        <div className=\"App\">\n            {userName ? (\n                <div className=\".book__form\">\n                    <button onClick={() => getBooks()}>Refresh</button>\n                    <button className=\"logout\" onClick={logout}>\n                        Logout\n                    </button>\n                    <br />\n                    {isLoading ? <p>LOADING DATA</p> : false}\n                    <br />\n                    {userName && <span>logged in as {userName}</span>}\n                    <br />\n                    <span>{message}</span>\n                    {books.map((b) => (\n                        <p\n                            className=\"book\"\n                            onClick={() => setBookToEdit(b)}\n                            key={b.id}\n                            style={{\n                                backgroundColor: `${\n                                    bookToEdit === b ? \"grey\" : \"transparent\"\n                                }`,\n                            }}\n                        >\n                            title: {b.title + \" - \"}\n                            author: {b.author + \" - \"}\n                            price: {b.priceInEuro}\n                            <button onClick={() => deleteBook(b)}>\n                                Delete\n                            </button>\n                        </p>\n                    ))}\n                    <Form\n                        bookToEdit={bookToEdit}\n                        setIsLoading={setIsLoading}\n                        addBook={(body) => setBooks([...books, body])}\n                        setBooks={setBooks}\n                        setMessage={setMessage}\n                        fetchWithCsrf={fetchWithCsrf}\n                    />\n                </div>\n            ) : (\n                <Login authenticate={authenticate} />\n            )}\n        </div>\n    );\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}